---
layout: post
title:  "proxmark3 quick start with docker"
lang: en
tags: [en, rfid, proxmark]
published: true
---

## how to start using proxmark3

these a my notes on how to create a dev environment, complile the firmware and software for the proxmark3, flash it and run the client, all in a docker container.

## hardware

- **proxmark3 easy 512**, connected to the host/vm (assumed as `/dev/ttyACM0`)

## host setup

linux host/vm with docker installed. might work on other platforms with docker too. docker is installed like this (the example is for Debian. Ubuntu needs to replace `debian` with `ubuntu` in the repo link):

```
sudo apt update
sudo apt install ca-certificates curl

install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/debian/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian \
  "$(. /etc/os-release && echo "$VERSION_CODENAME")" stable" | \
  tee /etc/apt/sources.list.d/docker.list > /dev/null
  
sudo apt update
sudo apt install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
sudo groupadd docker
sudo usermod -aG docker $USER
```

proxy for dockerhub can be set up like this:

```
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "proxies": {
    "http-proxy": "http://127.0.0.1:7897",
    "https-proxy": "http://127.0.0.1:7897",
    "no-proxy": "localhost,127.0.0.1,127.0.0.0/8"
  }
}
EOF

sudo systemctl daemon-reload
sudo systemctl restart docker
```

proxy for containers themselves to use can be set up like this:

```
sudo mkdir -p /etc/systemd/system/docker.service.d

sudo tee /etc/systemd/system/docker.service.d/http-proxy.conf <<-'EOF'
[Service]
Environment="HTTP_PROXY=http://127.0.0.1:7897"
Environment="HTTPS_PROXY=http://127.0.0.1:7897"
Environment="NO_PROXY=localhost,127.0.0.1,127.0.0.0/8"
EOF

sudo systemctl daemon-reload
sudo systemctl restart docker
sudo systemctl show docker --property Environment
```


## proxmark3 development environment setup

it is preferrable to use a virtual machine and not an actual host with Linux, since we need to disable ModemManager to prevent it from interfering with the proxmark3 device. on the host:


```
sudo systemctl stop ModemManager
sudo systemctl disable ModemManager

mkdir -p ~/iceman/docker
mkdir ~/iceman/proxmark-docker-data
cd ~/iceman/docker
```

```
tee Dockerfile <<-'EOF'

FROM ubuntu:22.04

RUN apt update

RUN DEBIAN_FRONTEND=noninteractive TZ=Asia/Shanghai apt-get -y install tzdata

RUN apt install ca-certificates -y

COPY <<EOF /etc/apt/sources.list
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse
deb http://security.ubuntu.com/ubuntu/ jammy-security main restricted universe multiverse
EOF

RUN apt update && apt install -y --no-install-recommends nano git ca-certificates build-essential pkg-config libreadline-dev gcc-arm-none-eabi libnewlib-dev qtbase5-dev libbz2-dev liblz4-dev libbluetooth-dev libpython3-dev libssl-dev libgd-dev

WORKDIR /root
EOF
```

```
tee docker-compose.yml <<-'EOF'
name: proxmark3_custom

services:
  ubuntu:
    build: .
    image: ubuntu_custom:22.04
    container_name: proxmark3_custom
    # to keep the container running
    command: tail -f /dev/null
    volumes:
      - $HOME/iceman/proxmark-docker-data:/root
      - /tmp/.X11-unix:/tmp/.X11-unix
      - /dev:/dev
      - /run/udev:/run/udev:ro
    environment:
      - DISPLAY=$DISPLAY
    privileged: true
    network_mode: host
    restart: unless-stopped

EOF
```

this is a dev container, intended to be running indefinitely, and all operations are done inside it

```
docker compose up -d --build --force-recreate
docker exec -it proxmark3_custom bash
```

inside the container (all of this can be put into the Dockerfile as well):
```
git clone https://github.com/RfidResearchGroup/proxmark3.git
cd proxmark3
make accessrights
[ -r /dev/ttyACM0 ] && [ -w /dev/ttyACM0 ] && echo ok

tee Makefile.platform <<-'EOF'
PLATFORM=PM3GENERIC
STANDALONE=HF_AVEFUL
INSTALLSUDO=sudo
EOF

make clean && make -j
```

since the firmware must be the same version as the client, each time afer pulling a new version we must flash the bootloader and the firmware:

```
./pm3-flash -b /root/proxmark3/bootrom/obj/bootrom.elf
./pm3-flash-all
```

start the client:

```
/root/proxmark3/client/proxmark3 /dev/ttyACM0
```

then it can also be done from the host directly like this:

```
docker exec -it proxmark3_custom /root/proxmark3/client/proxmark3 /dev/ttyACM0
```

naturally, it can also be done remotely via ssh using local and remote docker daemons:

```
DOCKER_HOST="ssh://$USER@dockerhost" docker exec -it proxmark3_custom  /root/proxmark3/client/proxmark3 /dev/ttyACM0
```