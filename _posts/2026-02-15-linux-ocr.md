---
layout: post
title:  "OCR pipeline in Linux (jpg to pdf/txt)"
lang: en
tags: [en, linux]
category: tutorial
published: true
---

## shell script pipeline to convert a directory of images into editable pdf or plain text


Install the necessary software. look up packages to install for languages other than English `apt-cache search tesseract-ocr`. `ocrmypdf` acts as the wrapper around Tesseract OCR. I needed Russian, so I did:

```bash
sudo apt install tesseract-ocr ghostscript tesseract-ocr-script-cyrl tesseract-ocr-rus ocrmypdf
```

the pipeline involves using ImageMagick to enhance jpg files before doing OCR, the default memory limits must be changed to process large images:

```bash
sudo sed -i '/<policy domain="resource" name="memory"/ s/value="1024MiB"/value="30GiB"/' /etc/ImageMagick-6/policy.xml

```

run **the pipeline** (run on the images in current directory):

```bash
for f in *.jpg; do convert "$f" -colorspace gray -fill white -resize 200% -sharpen 0x1 "bw/$f"; echo "."; done
convert $(ls -v ./bw/*.jpg) in.pdf
ocrmypdf -l rus --output-type pdfa in.pdf out.pdf
pdftotext out.pdf out.txt
```

## references:

- https://github.com/ocrmypdf/OCRmyPDF
- https://github.com/ElectricRCAircraftGuy/PDF2SearchablePDF
- https://unix.stackexchange.com/questions/377359/how-to-use-ocr-from-the-command-line-in-linux